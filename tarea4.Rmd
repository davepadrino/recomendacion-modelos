---
title: "Tarea 4"
author: "David Padrino"
date: "May 4, 2016"
output: html_document
---
# Tarea #4 Minería de Datos
La presente tarea consta de dos actividades que se dividen en 
- Distemas de Recomendación
- Curvas ROC 

## Introducción
---------------
## Primera Parte: Sistemas de Recomendación
### Se procede en primera instancia a la carga de las bibliotecas a usar en el desarrollo de esta primera actividad

```{r setup, message=FALSE, warning=FALSE}
#install.packages("arules")
#install.packages("dplyr")
#install.packages("arulesViz")
library("arules")
library("dplyr")
library("arulesViz")
```

Se procede a la lectura de los archivos a utilizar para realizar el analisis exploratorio

```{r}
periodico <- read.csv("periodico.csv")
ejemplo <- read.csv("ejemplo.csv")
```

Para comenzar con el análisis exploratorio se solicita el nombre de sus columnas para asi determinar si hay alguna que no sirva para el análisis.

```{r}
names(ejemplo)
names(periodico)
colnames(periodico)[5] <-  "items"
head(ejemplo$X)

```

De primera pasada todas las columnas parecen tener sentido excepto una, 'X', al observar su contenido, parecen índices que no tienen mucha utilidad en las actividades. Proceden a eliminarse.

```{r}
ejemplo$X <- NULL
periodico$X <- NULL
```

### Transacciones bot
```{r}
periodico2 <- periodico

example.bots <- as.character()
time <- as.numeric()
for(i in 1:length(periodico2$entry)){
  calc <- as.numeric(difftime(periodico2$exit[i], periodico2$entry[i], unit="sec"))
  time <- append(time,calc)
  if (calc < 21){
    example.bots <- append(example.bots, as.character(periodico2$ID[i]))
  }
}
periodico2$times <- time
rm(time)



#periodico$entry <- as.POSIXct(periodico$entry, origin = "1970-01-01")
#periodico$exit <- as.POSIXct(periodico$exit, origin = "1970-01-01")
#periodico <- mutate(periodico, estadia = exit - entry)




#periodico <- mutate(periodico, estadia = exit - entry)
#estadia <- periodico$estadia
# 9961



as.Date(as.character(periodico2$exit[9961],format="%Y-%m-%d"))-as.Date(as.character(periodico2$entry[9961],format="%Y-%m-%d")) 

as.Date(as.character(periodico2$exit[9961],format="%Y-%m-%d"))-as.Date(as.character(periodico2$entry[9961],format="%Y-%m-%d"))

as.numeric(difftime(as.Date(as.character(periodico2$exit[9961],format="%Y-%m-%d %H:%M:%OS")), as.Date(as.character(periodico2$entry[9961],format="%Y-%m-%d %H:%M:%OS")), unit="sec"))

as.numeric(difftime(as.POSIXct(periodico2$exit[9961], origin = "1970-01-01"), as.POSIXct(periodico2$entry[9961], origin = "1970-01-01"), unit="sec"))


as.numeric((as.POSIXct(periodico2$exit[9961], origin = "1970-01-01") - as.POSIXct(periodico2$entry[9961], origin = "1970-01-01")))


as.numeric(difftime(periodico2$exit[9961], periodico2$entry[9961], unit="sec"))



as.POSIXct



ejemplo2 <- ejemplo
ejemplo2$entry <- as.POSIXct(ejemplo2$entry)
ejemplo2$exit <- as.POSIXct(ejemplo2$exit)
example.bots2 <- as.character()
time2 <- as.numeric()
for(i in 1:length(ejemplo2$entry)){
  calc2 <- as.numeric(difftime(ejemplo2$exit[i], ejemplo2$entry[i], unit="sec"))
  time2 <- append(time2,calc2)
  if (calc < 21){
    example.bots2 <- append(example.bots2, as.character(ejemplo2$ID[i]))
  }
}
ejemplo2$times <- time2
rm(time2)






```
Se realiza un ciclo para obtener la diferencia entre los tiempos de acceso y se obtiene un vector con el siguiente tamaño y las siguientes transacciones (solo se mostrarán las 6 primeras)

```{r}
length(example.bots)
head(example.bots)
```
El vector anterior es una muestra de los accesos que duran 20 segundos o menos, haciendo alusión a la posible presencia de bots.

### Actividad 1
Modificar su dataset de tal manera que no se lean los identificadores de los artículos como itemN sino
por su tipo de contenido contenido/articuloN. Ejemplo: {item1, item10, item81} es la transacción
{deportes/articulo1, politica/articulo1, opinion/articulo9}.

```{r}
contenido <- c("deportes","politica","variedades","internacional","nacionales","sucesos","comunidad","negocios","opinion")

unliststr <- function(vec){
  it <- unlist(strsplit(vec, ","))
  numbers <- unique(na.omit(as.numeric(unlist(strsplit(as.character(it), "[^0-9]+")))))
  element <- character()
  for (i in 1:length(numbers)){
    if(floor(((numbers[i]/9) %% 1)*10)!=0){
      group <- as.integer((numbers[i]/9)+1)
      article <- floor(((numbers[i]/9) %% 1)*10)
      article <- paste(c("articulo",article), collapse = "")
      item <- paste(c(contenido[group],article), collapse = "/")
      element <- paste(c(element,item), collapse = ",")
    }else{
      group <- as.integer(numbers[i]/9)
      article <- paste(c("articulo",9), collapse = "")    
      item <- paste(c(contenido[group],article), collapse = "/")
      element <- paste(c(element,item), collapse = ",")
  
    }
  }
  return(element)
}

periodico$items <- as.character(periodico$items)
items <- sapply(periodico$items, unliststr)
periodico$articulos <- sapply(periodico$items, unliststr)
rm(items)
```

### Actividad 2
```{r}


```

### Actividad 3
```{r}


```


### Actividad 4
Conocer las 10 visitas con mayor tiempo de estadía en la página y las 10 visitas con menor tiempo de
estadía en la página.
### Actividad 2
```{r}
times.order <- sort(periodico$times, decreasing = FALSE)
head(times.order, 10)
last(times.order, 10)
```






