---
title: "Tarea 4"
author: "David Padrino"
date: "May 4, 2016"
output: html_document
---
# Tarea #4 Miner√?a de Datos
La presente tarea consta de dos actividades que se dividen en 
- Distemas de Recomendaci√≥n
- Curvas ROC 

## Introducci√≥n
---------------
## Primera Parte: Sistemas de Recomendaci√≥n
### Se procede en primera instancia a la carga de las bibliotecas a usar en el desarrollo de esta primera actividad

```{r setup, message=FALSE, warning=FALSE}
#install.packages("arules")
#install.packages("dplyr")
#install.packages("arulesViz")
library("arules")
library("dplyr")
library("arulesViz")
```

Se procede a la lectura de los archivos a utilizar para realizar el analisis exploratorio

```{r}
periodico <- read.csv("periodico.csv")
ejemplo <- read.csv("ejemplo.csv")
```

Para comenzar con el an√°lisis exploratorio se solicita el nombre de sus columnas para asi determinar si hay alguna que no sirva para el an√°lisis.

```{r}
names(ejemplo)
names(periodico)
colnames(periodico)[5] <-  "items"
head(ejemplo$X)

```

De primera pasada todas las columnas parecen tener sentido excepto una, 'X', al observar su contenido, parecen √?ndices que no tienen mucha utilidad en las actividades. Proceden a eliminarse.

```{r}
ejemplo$X <- NULL
periodico$X <- NULL
```

### Transacciones bot
```{r}
example.bots <- as.character()
time <- as.numeric()
for(i in 1:length(periodico$entry)){
  calc <- as.numeric(difftime(periodico$exit[i], periodico$entry[i], unit="sec"))
  time <- append(time,calc)
  if (calc < 21){
    example.bots <- append(example.bots, as.character(periodico$ID[i]))
  }
}
periodico$times <- time
rm(time)
```
Se realiza un ciclo para obtener la diferencia entre los tiempos de acceso y se obtiene un vector con el siguiente tama√±o y las siguientes transacciones (solo se mostrar√°n las 6 primeras)

```{r}
length(example.bots)
head(example.bots)
```
El vector anterior es una muestra de los accesos que duran 20 segundos o menos, haciendo alusi√≥n a la posible presencia de bots.

### Actividad 1
Modificar su dataset de tal manera que no se lean los identificadores de los art√?culos como itemN sino
por su tipo de contenido contenido/articuloN. Ejemplo: {item1, item10, item81} es la transacci√≥n
{deportes/articulo1, politica/articulo1, opinion/articulo9}.

```{r}
contenido <- c("deportes","politica","variedades","internacional","nacionales","sucesos","comunidad","negocios","opinion")

unliststr <- function(vec){
  it <- unlist(strsplit(vec, ","))
  numbers <- unique(na.omit(as.numeric(unlist(strsplit(as.character(it), "[^0-9]+")))))
  element <- character()
  for (i in 1:length(numbers)){
    if(floor(((numbers[i]/9) %% 1)*10)!=0){
      group <- as.integer((numbers[i]/9)+1)
      article <- floor(((numbers[i]/9) %% 1)*10)
      article <- paste(c("articulo",article), collapse = "")
      item <- paste(c(contenido[group],article), collapse = "/")
      element <- paste(c(element,item), collapse = ",")
    }else{
      group <- as.integer(numbers[i]/9)
      article <- paste(c("articulo",9), collapse = "")    
      item <- paste(c(contenido[group],article), collapse = "/")
      element <- paste(c(element,item), collapse = ",")
  
    }
  }
  return(element)
}

periodico$article <- sapply(as.character(periodico$items), unliststr)
```

### Actividad 2
```{r}


```

### Actividad 3
Dado un usuario nuevo que haya ingresado a n art√≠culos (n variable), poder recomendar un art√≠culo n+1
y as√≠ aumentar el compromiso del cliente con su portal web. Como usted sabe, para poder calcular las
reglas necesita como entrada MinSupport y MinConfianza. Sin embargo, el cliente desconoce cu√°les
son estos valores en consecuencia es tarea de usted determinar y justificar los mismos de acuerdo a su
criterio.

En esta actividad se procede a transformar la columnas (items, por comodidad en lectura), a caracter para poder nombrar las columnas del nuevo dataframe (creado al estilo disperso para saber que usuario ha visto cual art√≠culo), de esta forma convertirlo en transacciones y aplicar el algoritmo apriori para saber poder realizar las recomendaciones.
```{r}
items <- as.character(periodico$articulos)
items.names <- unique(unlist(strsplit(items, split = ',')))
nodata <- as.data.frame(matrix(nrow = length(items), ncol = length(items.names)))
colnames(nodata) <- items.names
for (i in 1:length(items)){
  aux <- unlist(strsplit(items[i], split = ','))
  for (j in aux){
    nodata[i,j] <- T
  }
}
datransactions <- as(nodata, "transactions")
#itemFrequency(datransactions2, "absolute")
rules <- apriori(datransactions2, parameter = list(supp = 0.000616908, conf = 0.98, target = "rules"))
inspect(subset(rules, subset = lhs %ain% c("deportes/articulo1","deportes/articulo2")))
#inspect(subset(rules, subset = lhs %ain% c("politica/articulo1")))
#inspect(rules)





```


### Actividad 4
Conocer las 10 visitas con mayor tiempo de estad√?a en la p√°gina y las 10 visitas con menor tiempo de
estad√?a en la p√°gina.
```{r}
times.order <- sort(periodico$times, decreasing = FALSE)
head(times.order, 10)
tail(times.order,10)
rm(times.order)
```

### Actividad 5
Conocer las 10 transacciones con mayor numeor de apariciones en el dataset
```{r}
# 10 items con mas apariciones
nueva <- periodico
nueva$entry <- NULL
nueva$exit <- NULL
nueva$times <- NULL
nueva$articulos <- NULL
nueva <- as(nueva, "transactions")
head(sort(itemFrequency(nueva, "absolute"), decreasing = T), 10)
#rm(nueva)
# 10 TransactionID con mas apariciones
#summary(periodico, maxsum = 11)[,1]
head(sort(table(periodico$ID), decreasing = T), 10)

```




