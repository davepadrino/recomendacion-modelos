---
title: "Tarea 4"
author: "David Padrino"
date: "May 4, 2016"
output: html_document
---
# Tarea #4 Minería de Datos
La presente tarea consta de dos actividades que se dividen en 
- Distemas de Recomendación
- Curvas ROC 

## Introducción
---------------
## Primera Parte: Sistemas de Recomendación
### Se procede en primera instancia a la carga de las bibliotecas a usar en el desarrollo de esta primera actividad

```{r setup, message=FALSE, warning=FALSE}
#install.packages("arules")
#install.packages("dplyr")
#install.packages("arulesViz")
library("arules")
library("dplyr")
library("arulesViz")
```

Se procede a la lectura de los archivos a utilizar para realizar el analisis exploratorio

```{r}
periodico <- read.csv("periodico.csv")
ejemplo <- read.csv("ejemplo.csv")
```

Para comenzar con el análisis exploratorio se solicita el nombre de sus columnas para asi determinar si hay alguna que no sirva para el análisis.

```{r}
names(ejemplo)
names(periodico)
colnames(periodico)[5] <-  "items"
head(ejemplo$X)

```

De primera pasada todas las columnas parecen tener sentido excepto una, 'X', al observar su contenido, parecen índices que no tienen mucha utilidad en las actividades. Proceden a eliminarse.

```{r}
ejemplo$X <- NULL
periodico$X <- NULL
```

### Transacciones bot
```{r}
example.bots <- as.character()
time <- as.numeric()
for(i in 1:length(periodico$entry)){
  calc <- as.numeric(difftime(periodico$exit[i], periodico$entry[i], unit="sec"))
  time <- append(time,calc)
  if (calc < 21){
    example.bots <- append(example.bots, as.character(periodico$ID[i]))
  }
}
periodico$times <- time
rm(time)
```
Se realiza un ciclo para obtener la diferencia entre los tiempos de acceso y se obtiene un vector con el siguiente tamaño y las siguientes transacciones (solo se mostrarán las 6 primeras)

```{r}
length(example.bots)
head(example.bots)
```
El vector anterior es una muestra de los accesos que duran 20 segundos o menos, haciendo alusión a la posible presencia de bots.

### Actividad 1
Modificar su dataset de tal manera que no se lean los identificadores de los artículos como itemN sino
por su tipo de contenido contenido/articuloN. Ejemplo: {item1, item10, item81} es la transacción
{deportes/articulo1, politica/articulo1, opinion/articulo9}.

```{r}
contenido <- c("deportes","politica","variedades","internacional","nacionales","sucesos","comunidad","negocios","opinion")

unliststr <- function(vec){
  it <- unlist(strsplit(vec, ","))
  numbers <- unique(na.omit(as.numeric(unlist(strsplit(as.character(it), "[^0-9]+")))))
  element <- character()
  for (i in 1:length(numbers)){
    if(floor(((numbers[i]/9) %% 1)*10)!=0){
      group <- as.integer((numbers[i]/9)+1)
      article <- floor(((numbers[i]/9) %% 1)*10)
      article <- paste(c("articulo",article), collapse = "")
      item <- paste(c(contenido[group],article), collapse = "/")
      element <- paste(c(element,item), collapse = ",")
    }else{
      group <- as.integer(numbers[i]/9)
      article <- paste(c("articulo",9), collapse = "")    
      item <- paste(c(contenido[group],article), collapse = "/")
      element <- paste(c(element,item), collapse = ",")
  
    }
  }
  return(element)
}

periodico$articulos <- sapply(as.character(periodico$items), unliststr)
```

### Actividad 2
```{r}


```

### Actividad 3
Dado un usuario nuevo que haya ingresado a n artículos (n variable), poder recomendar un artículo n+1
y así aumentar el compromiso del cliente con su portal web. Como usted sabe, para poder calcular las
reglas necesita como entrada MinSupport y MinConfianza. Sin embargo, el cliente desconoce cuáles
son estos valores en consecuencia es tarea de usted determinar y justificar los mismos de acuerdo a su
criterio.
```{r}
items <- as.character(periodico$items)


```


### Actividad 4
Conocer las 10 visitas con mayor tiempo de estadía en la página y las 10 visitas con menor tiempo de
estadía en la página.
```{r}
times.order <- sort(periodico$times, decreasing = FALSE)
head(times.order, 10)
tail(times.order,10)
rm(times.order)
```

### Actividad 5
Conocer las 10 transacciones con mayor numeor de apariciones en el dataset
```{r}
# 10 items con mas apariciones
nueva <- periodico
nueva$entry <- NULL
nueva$exit <- NULL
nueva$times <- NULL
nueva$articulos <- NULL
nueva <- as(nueva, "transactions")
head(sort(itemFrequency(nueva, "absolute"), decreasing = T), 10)
#rm(nueva)
# 10 TransactionID con mas apariciones
#summary(periodico, maxsum = 11)[,1]
head(sort(table(periodico$ID), decreasing = T), 10)











aux <- periodico$items
aux <- as.character(aux)
aux <- gsub(pattern = "}",x=aux,replacement = "")
aux <- gsub(pattern = "\\{",x=aux,replacement = "")
aux <- gsub(pattern = " ",x=aux,replacement = "")

aux <- aux

#construyo la matriz de transacciones
nuevo <- matrix(nrow=length(aux) , ncol = 81)
nuevo[,] <- F
nuevo <- as.data.frame(nuevo)
colnames(nuevo) <- valores
for (i in 1:length(aux)){
  a <- unlist(strsplit(aux[i],split = ","))
  print(paste("va por la: ",i))
  for (j in a){
    nuevo[i,j] <- T 
  }
}
View(nuevo)


trans <- as(nuevo, "transactions")
summary(trans)
unique(trans)

itemFrequencyPlot(trans, topN = 10, "absolute")
itemFrequency(trans, "absolute")

reglas <- apriori(trans, parameter = list(supp = 0.00003, conf = 0.8, target = "rules"))


#in es cualquiera de los 2 , %ain% son los 2
inspect(subset(reglas, subset = lhs %ain% c("politica/articulo1","deporte/articulo1")))

inspect(reglas)
```




